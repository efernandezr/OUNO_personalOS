---
description: View Perplexity API budget status and usage history
---

# /perplexity-budget

View detailed Perplexity API budget status, including regular queries and deep research usage.

## Usage

```
/perplexity-budget
```

No parameters required. Displays current month's budget status.

## Prerequisites

- Perplexity must be configured (`./scripts/enable-perplexity.sh`)
- `config/research.yaml` exists with budget settings
- `system/cache/perplexity/usage.yaml` exists with usage tracking

## Execution Steps

### Step 1: Check Configuration

1. Check if `config/research.yaml` exists
2. If not exists, display:
   ```
   Perplexity is not configured.
   Run ./scripts/enable-perplexity.sh to enable real-time intelligence.
   ```
   Exit command.

### Step 2: Load Configuration and Usage

Read these files:
- `config/research.yaml` - Get budget limits:
  ```yaml
  budget:
    monthly_limit_usd: 25.00        # Regular queries
    alert_threshold_pct: 80
    deep_research:
      monthly_limit_usd: 20.00      # Deep research
      alert_threshold_pct: 50
  ```

- `system/cache/perplexity/usage.yaml` - Get current usage:
  ```yaml
  current_month: "2026-01"
  regular:
    queries_count: 15
    estimated_cost_usd: 0.35
    last_updated: "2026-01-11T10:30:00Z"
  deep_research:
    queries_count: 2
    estimated_cost_usd: 8.50
    last_updated: "2026-01-10T14:00:00Z"
    history: [...]
  total_cost_usd: 8.85
  budget_exceeded: false
  deep_research_budget_exceeded: false
  ```

### Step 3: Calculate Status

For each budget category:
```
remaining = limit - used
pct_used = (used / limit) * 100
pct_remaining = 100 - pct_used

status_emoji:
  - pct_used >= 100: "üî¥ Budget Exceeded"
  - pct_used >= alert_threshold: "‚ö†Ô∏è Alert Threshold"
  - pct_used >= 50: "üü° Moderate Usage"
  - else: "üü¢ OK"
```

### Step 4: Format Output

Display formatted budget report:

```markdown
# Perplexity Budget Status

## Current Month: {month_name} {year}

### Budget Summary

| Category | Used | Limit | Remaining | Status |
|----------|------|-------|-----------|--------|
| Regular Queries | ${regular.used} | ${regular.limit} | ${regular.remaining} ({regular.pct_remaining}%) | {status_emoji} |
| Deep Research | ${deep.used} | ${deep.limit} | ${deep.remaining} ({deep.pct_remaining}%) | {status_emoji} |
| **Total** | **${total.used}** | **${total.limit}** | **${total.remaining}** | |

### Alert Thresholds

- Regular queries: Alert at {regular.alert_threshold}% (${regular.alert_amount})
- Deep research: Confirmation required above {deep.alert_threshold}% (${deep.alert_amount})

---

### Regular Query Usage

| Metric | Value |
|--------|-------|
| Queries this month | {regular.queries_count} |
| Estimated cost | ${regular.estimated_cost_usd} |
| Last query | {regular.last_updated or "Never"} |

**Cost estimate**: ~$0.005 per search, ~$0.02 per reasoning query

---

### Deep Research Usage

| Metric | Value |
|--------|-------|
| Reports this month | {deep.queries_count} |
| Estimated cost | ${deep.estimated_cost_usd} |
| Last research | {deep.last_updated or "Never"} |

**Cost estimate**: ~$3-5 per deep research report (varies by topic complexity)

{If deep_research.history not empty:}
#### Research History (This Month)

| Date | Topic | Est. Cost |
|------|-------|-----------|
{For each entry in deep_research.history:}
| {entry.date} | {entry.topic} | ~${entry.cost} |

---

### Budget Projections

Based on current usage rate:

**Regular Queries:**
- Daily average: ${daily_avg_regular}
- Projected month-end: ${projected_regular}
- {If projected > limit: "‚ö†Ô∏è May exceed budget by ${overage}"}

**Deep Research:**
- Average per report: ${avg_per_report}
- Remaining capacity: ~{remaining_reports} reports
- {If deep.pct_used > 50: "üí° Tip: Use /market-intelligence --deep sparingly"}

---

### Quick Reference

| Command | Perplexity Usage | Est. Cost |
|---------|------------------|-----------|
| /daily-brief | 1-2 queries | ~$0.01-0.02 |
| /market-intelligence | 2-5 queries | ~$0.02-0.05 |
| /market-intelligence --deep | 2-5 + deep research | ~$3-8 |
| /deep-research | 1 deep research | ~$3-5 |

---

### Budget Management

**To adjust budgets**, edit `config/research.yaml`:
```yaml
budget:
  monthly_limit_usd: 25.00      # Regular queries
  deep_research:
    monthly_limit_usd: 20.00    # Deep research
```

**To skip Perplexity** for a single command:
```
/market-intelligence --no-real-time
/daily-brief --no-real-time
```

**Budget resets**: 1st of each month

---

*Generated by PersonalOS | perplexity-budget | {date}*
```

### Step 5: Handle Edge Cases

#### No Usage File

If `system/cache/perplexity/usage.yaml` doesn't exist:

```markdown
# Perplexity Budget Status

## Current Month: {month_name} {year}

No usage recorded yet. Perplexity has not been used this month.

### Budget Limits

| Category | Limit |
|----------|-------|
| Regular Queries | ${regular_limit}/month |
| Deep Research | ${deep_limit}/month |
| **Total** | **${total_limit}/month** |

Run `/market-intelligence` or `/daily-brief` to start using Perplexity.
```

#### Month Rollover

If `usage.yaml` has a different month than current:

1. The month has rolled over
2. Display message: "New month! Usage has been reset."
3. Note: Actual reset happens when next command writes to usage.yaml

## Output

This command outputs directly to the terminal. No file is written.

## Related Commands

- `/market-intelligence` - Uses regular Perplexity queries
- `/market-intelligence --deep` - Uses deep research
- `/deep-research` - Standalone deep research
- `/daily-brief` - Uses light Perplexity queries

## Budget Tips

1. **Cache saves money**: Same-day queries hit cache (24h TTL)
2. **--no-real-time**: Skip Perplexity entirely when not needed
3. **Deep research**: Use selectively, costs ~$3-5 per report
4. **Check weekly**: Run this command to stay on track

## Example Output

```
# Perplexity Budget Status

## Current Month: January 2026

### Budget Summary

| Category | Used | Limit | Remaining | Status |
|----------|------|-------|-----------|--------|
| Regular Queries | $0.35 | $25.00 | $24.65 (98%) | üü¢ OK |
| Deep Research | $8.50 | $20.00 | $11.50 (58%) | ‚ö†Ô∏è Alert Threshold |
| **Total** | **$8.85** | **$45.00** | **$36.15** | |

### Deep Research Usage

| Date | Topic | Est. Cost |
|------|-------|-----------|
| 2026-01-08 | AI Agents in Marketing | ~$4.25 |
| 2026-01-10 | MCP Ecosystem | ~$4.25 |

Budget resets: February 1, 2026
```
